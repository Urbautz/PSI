<!DOCTYPE html>
<html>
<body>

<textarea id="input" width="500px"> </textarea>
<button onclick="mach()">Click me</button>
<div id="debug"></div>
<script>

  let linecount = 0;
  let lineprocessed = 1;
  let currentHeader = 'ERROR';
  // Array mit Struktur: Bereich, Teilbereich, X, Y, Z
  let matrix = [[[]]];
  let defaults = [];

function debug(text, level = 0) {
  switch (level) {
    case 0:
      document.getElementById("debug").innerHTML += '<p class="debug">'+text+"</p>";
      break;
    case 1:
      document.getElementById("debug").innerHTML += '<p class="warning">'+text+"</p>";
      break;
    default:
      document.getElementById("debug").innerHTML += '<p class="error">EEEERRRROOOOORRRRRR: '+text+"</p>";
  }
}

function mach() {
	result = csv(document.getElementById("input").value);
}

function csv(data) {
  debug ("Starting ...");
  let lines = data.split(/\r\n|\n/);

  linecount = lines.length;
  debug("Number of Lines: " + linecount);
  for (let i=0; i<linecount; i++) {
    debug("Next Line:" + lineprocessed);
    let elements = lines[i].split(";");
    switch (elements[0]) { 
      case "#":
        debug("Type of Line: '" + elements[0] + "': Comment: Ignore");
        debug("Ignore");
        break;
      case "": 
        debug("Type of Line: '" + elements[0] + "': Data");
        processData(elements);
        break;
      case "%":
        debug("Type of Line: '" + elements[0] + "': Defaults");
        defaults = elements;
        break;
      case ">":
        debug("Type of Line: '" + elements[0] + "': Header");
        currentHeader = elements[1];
        debug("Set header to " + currentHeader);
        break;
      case "!":
        debug("Type of Line: '" + elements[0] + "': Lineheader: Ignore");
        break;
      default:
        debug("Type of Line: '" + elements[0] + "': UNDEFINED!", 2);
        break;

    } // end switch
    debug("Type of Line: '" + elements[0] + "");

    lineprocessed += 1;
  } // end for
} // end function

function processData(elements) {
  switch (currentHeader) {
    case 'BE' : 
      debug()
    break;
    case 'PL' :
    break;
    default:
      debug("Unknown Header: " + currentHeader,1);
    break;
  }

}

</script>

</body>
</html>
