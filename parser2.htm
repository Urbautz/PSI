<!DOCTYPE html>
<html>
  <head>

    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/dist/styles/ag-grid.css">
    <link rel="stylesheet" href="https://unpkg.com/ag-grid-community/dist/styles/ag-theme-alpine.css">
    <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>
    <style>
      body {
        font-family: Verdana, Geneva, Tahoma, sans-serif;
      }
      .inout {
        margin: 1rem;
        padding: 2rem 2rem;
        text-align: center;
        height: 100px;
      }
      .top {
        display: inline-block;
        padding: 1rem 1rem;
        vertical-align: middle;
        height: 99px;
        overflow-x: auto;
      }

    #debug {
      width:200px;
      max-width: 200px;
      font-size:6px;
      
    }
  </style>
</head>

<body>
<div id="inout">
  <div id="in" class="top">
    <textarea id="input" rows="4" cols="40"> </textarea><br />
    <button onclick="mach()">Click me</button>
  </div>
  <div id="debug" class="top"></div>
  <div id="out" class="top">
    <textarea id="output" rows="4" cols="60"> </textarea>
  </div>
</main>

<script>

  let linecount = 0;
  let lineprocessed = 1;
  let currentHeader = 'NONE';
  // Array mit Struktur: Bereich, Teilbereich, X, Y, Z
  let matrix = [[[]]];

function debug(text, level = 0) {
    console.log(text);
  switch (level) {
    case 0:
      document.getElementById("debug").innerHTML += '<p class="hint">'+text+"</p>";
      break;
    case 1:
      document.getElementById("debug").innerHTML += '<p class="warning">'+text+"</p>";
      break;
    default:
      document.getElementById("debug").innerHTML += '<p class="error">EEEERRRROOOOORRRRRR: '+text+"</p>";
  }
  document.getElementById("debug").scrollBy(0, 100);
}

function mach() {
  linecount = 0;
  lineprocessed = 1;
  currentHeader = 'NONE'
  matrix.length = 0;
	result = csv(document.getElementById("input").value);
}

function csv(data) {
  debug ("Starting ...");
  let lines = data.split(/\r\n|\n/);

  linecount = lines.length;
  debug("Number of Lines: " + linecount);
  for (let i=0; i<linecount; i++) {
    debug("Next Line:" + lineprocessed);
    let elements = lines[i].split(";");
    switch (elements[0]) { 
      case "#":
        debug("Type of Line: '" + elements[0] + "': Comment");
        debug("Ignore");
        break;
      case "": 
        debug("Type of Line: '" + elements[0] + "': Data");
        break;
      case "%":
        debug("Type of Line: '" + elements[0] + "': Defaults");
        break;
      case ">":
        debug("Type of Line: '" + elements[0] + "': Header");
        currentHeader = elements[1];
        debug("Set header to " + currentHeader);
        break;
      case "!":
        debug("Type of Line: '" + elements[0] + "': Lineheader");
        break;
      default:
        debug("Type of Line: '" + elements[0] + "': UNDEFINED!");
        break;

    }
    debug("Type of Line: '" + elements[0] + "");

    lineprocessed += 1;
  }
}

</script>

</body>
</html>